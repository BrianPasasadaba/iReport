{% extends 'admin/admin_base.html' %}

{% block content%}


<div class="main-content">
  <div class="report-container col-12">
    <div class="incident-title">
      <div class="card-body d-flex">
        <div class="col-8">
          <p class="card-text">ANALYTICS</p>
        </div>
      </div>
    </div>
    <div class="analytics-container">
      <div class="card-body">
        <div class="row"> 
          <div class="col-8">
              <h3 class="card-title mb-0" >INCIDENTS FOR THE MONTH OF</h3>
          </div>
          <div class="col-4  d-flex justify-content-end align-middle">
              <select id="month-dropdown" class="report-button form-select month-dropdown">
                  <option value="1">January</option>
                  <option value="2">February</option>
                  <option value="3">March</option>
                  <option value="4">April</option>
                  <option value="5">May</option>
                  <option value="6">June</option>
                  <option value="7">July</option>
                  <option value="8">August</option>
                  <option value="9">September</option>
                  <option value="10">October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
              </select>
          </div>
      </div>

      <div class="row">
        <div class="col mt-3">
            <div class="legend-container">
                <span class="legend-circle medical"></span>
                <span class="legend-text">Medical Emergency</span>
            </div>
        </div>
        <div class="col mt-3">
            <div class="legend-container">
                <span class="legend-circle vehicular"></span>
                <span class="legend-text">Vehicular Accident</span>
            </div>
        </div>
        <div class="col mt-3">
            <div class="legend-container">
                <span class="legend-circle other"></span>
                <span class="legend-text">Other Emergencies</span>
            </div>
        </div>
        <div class="col d-flex justify-content-end align-middle">
            <div class="analytic-year mt-3" >
                <label for="year">YEAR</label>
            </div>
            <select id="year" class="report-button form-select month-dropdown">
                <option selected>2024</option>
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <option value="2024">2024</option>
                <!-- Add more years if necessary -->
            </select>
        </div>      
    </div> 
    </div>
    <div style="height: 24vw;">
        <canvas id="barChart"></canvas>
    </div>
    
    </div>
    </div>

    <div class="analytics-container">
      <div class="card-body">
          <div class="row">
              <div>
                  <h3 class="card-title mb-4">INCIDENTS PER BARANGAY</h3>
              </div>
          </div>
          <div class="row">
              <div class="col-3">
                  <div class="legend-container mb-3">
                      <span class="legend-circle medical"></span>
                      <span class="legend-text">Medical Emergency</span>
                  </div>
                  <div class="legend-container mb-3">
                      <span class="legend-circle vehicular"></span>
                      <span class="legend-text">Vehicular Accident</span>
                  </div>
                  <div class="legend-container mb-3">
                      <span class="legend-circle other"></span>
                      <span class="legend-text">Other Emergencies</span>
                  </div>
              </div> 
              <div class="col-9">
                <div id="map" style="height: 27vw;"></div>
              </div>
          </div>

          

      </div>
  </div>
  
  </div>
</div>
</div>
</div>
</div>
</div>

{% endblock %} 

{% block script %}

<script>
    var ctx = document.getElementById('barChart').getContext('2d');
    var chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {{ labels | tojson }},
            datasets: [{
                label: 'Count of Incidents',
                backgroundColor: [
                    'rgba(169, 18, 18, 0.7)', // Red
                    'rgba(16, 10, 81, 0.7)', // Blue
                    'rgba(40, 40, 40, 0.7)'   // Dark Gray
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)', // Red
                    'rgba(54, 162, 235, 1)', // Blue
                    'rgba(73, 73, 73, 1)'   // Dark Gray
                ],
                borderWidth: 1,
                data: {{ values | tojson }}
            }]
        },
        options: {
        plugins: {
            legend: {
                display: false
            }
        },
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
            min: 0,
            ticks: {
                // forces step size to be 50 units
                stepSize: 1
            }
            }
        }
        },
    });
</script>
<script>
    var map = L.map('map');

    // Add the OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Coordinates passed from Flask app
    var coordinates = {{ coordinates | tojson }};
    
    // Set initial map view (replace with your desired zoom level)
    map.setView([14.247142, 121.136673], 12); // Adjust zoom level as needed

    // Define marker icons
    var redIcon = new L.Icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });

    var blueIcon = new L.Icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });

    var blackIcon = new L.Icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
    });


    // Iterate through each coordinate and add a marker with appropriate icon
    coordinates.forEach(function(coord) {
        var markerIcon;
        switch (coord.category_id) {
            case 1:
                markerIcon = redIcon;
                break;
            case 2:
                markerIcon = blueIcon;
                break;
            case 3:
                markerIcon = blackIcon;
                break;
            default:
                markerIcon = redIcon; // Default to red if category_id doesn't match
                break;
        }

        var marker = L.marker([coord.lat, coord.lng], { icon: markerIcon }).addTo(map);
    });


</script>


{% endblock %}